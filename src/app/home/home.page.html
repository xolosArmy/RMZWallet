<ion-header>
  <ion-toolbar>
    <ion-title>Inicio</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-button
    expand="block"
    color="primary"
    (click)="onCreateWallet()"
    [disabled]="isCreatingWallet || isLoadingWallet"
  >
    {{ isCreatingWallet ? 'Creando cartera…' : 'Crear Cartera' }}
  </ion-button>

  <ion-card *ngIf="hasWallet" class="wallet-card">
    <ion-card-header>
      <ion-card-title>Mi Cartera</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <div class="wallet-row">
        <p class="wallet-label">Dirección</p>
        <p class="wallet-value">{{ wallet?.address }}</p>
      </div>

      <div class="wallet-row">
        <p class="wallet-label">Saldo</p>
        <p class="wallet-value">{{ formattedBalance }}</p>
      </div>

      <ion-button
        expand="block"
        fill="outline"
        color="medium"
        (click)="refreshBalance()"
        [disabled]="isRefreshingBalance"
      >
        {{ isRefreshingBalance ? 'Actualizando…' : 'Actualizar saldo' }}
      </ion-button>

      <ion-button expand="block" color="secondary" (click)="openSendModal()">
        Enviar
      </ion-button>
    </ion-card-content>
  </ion-card>

  <ion-item *ngIf="errorMessage" lines="none" class="error-item">
    <ion-text color="danger">{{ errorMessage }}</ion-text>
  </ion-item>

  <ion-modal [isOpen]="isSendModalOpen" (didDismiss)="closeSendModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Enviar XEC</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeSendModal()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <form [formGroup]="sendForm" (ngSubmit)="onSubmitSend()">
          <ion-item>
            <ion-label position="stacked">Dirección destino</ion-label>
            <ion-input
              formControlName="destination"
              autocomplete="off"
              autocorrect="off"
              autocapitalize="off"
            ></ion-input>
          </ion-item>

          <ion-item>
            <ion-label position="stacked">Monto (XEC)</ion-label>
            <ion-input type="number" formControlName="amount" min="0" step="0.000001"></ion-input>
          </ion-item>

          <ion-button
            expand="block"
            type="submit"
            color="primary"
            [disabled]="sendForm.invalid || isSending"
          >
            {{ isSending ? 'Enviando…' : 'Enviar' }}
          </ion-button>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
